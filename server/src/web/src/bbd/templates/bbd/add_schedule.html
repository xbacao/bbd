{% extends 'bbd/base.html' %}
{% load staticfiles %}

{% block content %}

<!-- <script>
function cloneMore(selector, type) {
  var newElement = $(selector).clone(true);
  var total = $('#id_' + type + '-TOTAL_FORMS').val();
  newElement.find(':input').each(function() {
      var name = $(this).attr('name').replace('-' + (total-1) + '-','-' + total + '-');
      var id = 'id_' + name;
      $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
  });
  newElement.find('label').each(function() {
      var newFor = $(this).attr('for').replace('-' + (total-1) + '-','-' + total + '-');
      $(this).attr('for', newFor);
  });
  total++;
  $('#id_' + type + '-TOTAL_FORMS').val(total);
  $(selector).after(newElement);
}
</script> -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

<script>
$(document).ready(function() {
       $("#form_sche").submit(function(event){
            $.ajax({
                 type:"POST",
                 url:"/bbd/create_new_schedule/",
                 data: {
                        'valveID_f': $('#valveID_f').val(),
                        'description': $('#description').val(),
                        'start_h': $('#start_h').val(),
                        'start_m': $('#start_m').val(),
                        'stop_h': $('#stop_h').val(),
                        'stop_m': $('#stop_m').val(),
                        },
                 success: function(){
                    alert("New schedule succesfully added!");
                    window.location.replace("/bbd/schedules/");
                 },
                 error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Error adding schedule!");
                    console.log("DBG XMLHttpRequest: "+XMLHttpRequest);
                    console.log("DBG textStatus:"+textStatus);
                    console.log("DBG errorThrown:"+errorThrown);
                 }
            });
            return false; //<---- move it here
       });

});
</script>
<ul>

<h1>New schedule</h1>
<!-- <form action="#" method="POST">
	{% csrf_token %}
	{{ cicle_form_set.management_form }}
	<table class='no_error'>
		<tr><td>ValveID</td><td>{{valve_id}}</td></tr>
		<tr><td>Description</td><td><input type="text" name="description"></td>
	</table>

	<h2>Cycles</h2>
	<div class='table'>
	{% for form in cicle_form_set.forms %}
			<table class='no_error'>
					<tr>
						<td>{{form.start_hour}}:{{form.start_min}}</td><td>=></td><td>{{form.stop_hour}}:{{form.stop_min}}</td>
					</tr>
			</table>
	{% endfor %}
	</div>


	<input type="button" value="add cycle" id="add_more">
	<script>
	    $('#add_more').click(function() {
	        cloneMore('div.table:last', 'service');
	    });
	</script>
	<input type="submit" class="btn" value="submit schedule" name="submit_sche">

</form> -->
<form method="post" id="form_sche">
  <table class="table table-striped table-hover">
    <tr><td class="col-md-4">ValveID</td><td class="col-md-8">{{valve_id}}</td></tr>
    <tr><td class="col-md-4">Description</td><td class="col-md-8"><input class="form-control" type="text" id="description"></td></tr>
    <tr>
      <td class="col-md-4">Watering Schedule</td>
      <td class="col-md-8">
        <div class="input-group">
          <span class="input-group-addon">Starting at:</span>
          <input class="form-control" size="2" type="text" id="start_h" placeholder="start hour">
          <span class="input-group-addon">:</span>
          <input class="form-control" size="2" type="text" id="start_m" placeholder="start min">
          <span class="input-group-addon"> Stoping at:</span>
          <input class="form-control" size="2" type="text" id="stop_h" placeholder="stop hour">
          <span class="input-group-addon">:</span>
          <input class="form-control" size="2" type="text" id="stop_m" placeholder="stop min">
        </div>
      </td>
    </tr>
  </table>
  <input type="hidden" id="valveID_f" value="{{valve_id}}"/>
  <button class="btn btn-default" type="submit">submit</button>
</form>

{% endblock %}
